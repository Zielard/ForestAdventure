<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forest Adventure</title>
<script src="scripts/Animation.js"></script> 
<script src="scripts/Collison.js"></script> 
<script src="scripts/Character.js"></script> 
<script src="scripts/boards.js"></script> 
<style>
#keyboardCanvas
{
    width:  100%;
  height: 100%;
}

#loadingMessage
{
    position:absolute;
    top:100px;
    left:100px;
    z-index:100;
    font-size:50px;
}
</style>

<script>

let backgroundImage = new Image();
backgroundImage.src = "images/boardElemets/BG/BG.png";



/* ObjectsGame array */
let ObjectsGame = [];


/* virtual joy*/
            let activeX =100;
            let activeY =100;

            let vjoyX =window.innerWidth * 0.1;
            let vjoyY =window.innerHeight* 0.9;

            let FramevjoyX =window.innerWidth*  0.1;
            let FramevjoyY =window.innerHeight* 0.9;

            let newPositionx =700;
            let newPositiony =200;

            let activeMouseClickx = null;
            let activeMouseClicky = null;

/*Szablony dla sprite*/
//(pathImage,size,spriteCol,spriteRow,numberSprite,spriteStart,spriteEnd)

let circleButton = new Image();
circleButton.src = "images/button/ps3-512.png";

let crossButton = new Image();
crossButton.src = "images/button/ps0-512.png";

let reloadButton = new Image();
reloadButton.src = "images/button/reload.png";

let CoinSprite = new Sprite("images/coin.png",20,10,1,10,0,10); 
let EnemySprite = new Sprite("images/enemy/2enemy.png",40,9,4,36,4,8);  
let FireBallSprite = new Sprite("images/fireball/fireball_1.png",40,8,8,64,0,8) 

let lastPushButton = 0;
const CANVAS_WIDTH = 1000;
const CANVAS_HEIGHT = 500;

let canvas = null;
let ctx = null;

let animationIndex = 1;
let flagNoAnimation = true;
let showCollisonLine = false;
let score = 0;

let flagRight = true;

var gravity = true;
var offgravity = false;
var falseDelta = 0;
var falseDeltaUP =10;

var falseDeltaEnemy = 0;

var colisionFigure = [];
var boardsLevel = [];
var backgroundSong = new Audio();
backgroundSong.src = 'mp3/Hyrule.mp3';

function playAudio() { 
    //var x = document.getElementById("myAudio");
  //x.play(); 
} 

function pauseAudio() { 
    //var x = document.getElementById("myAudio");
  //x.pause(); 
}
var supportsOrientationChange = "onorientationchange" in window,
    orientationEvent = supportsOrientationChange ? "orientationchange" : "resize";

window.addEventListener(orientationEvent, function() {
    alert('HOLY ROTATING SCREENS BATMAN:' + window.orientation + " " + screen.width);
}, false);

//Dla cordovy
//document.addEventListener("load", onAllAssetsLoaded); 
window.onload = onAllAssetsLoaded;
document.write("<div id='loadingMessage'>Loading...</div>");

function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          //x: evt.clientX - rect.left,
         // y: evt.clientY - rect.top
        };
      }

      Player.prototype.start = function ()
            {
                backgroundSong.play();
            };

function onAllAssetsLoaded()
{
    // colisionFigure.push(new Collsion_CubeDown(new Point(0, 390),new Point(15, 390),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(15, 440),new Point(50, 440),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(50, 400),new Point(130, 400),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(130, 440),new Point(250, 440),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(250, 400),new Point(460, 400),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(460, 290),new Point(520, 290),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(520, 380),new Point(640, 380),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(641, 425),new Point(691, 425),true)); 
    // colisionFigure.push(new Collsion_CubeDown(new Point(690, 290),new Point(705, 246),false));
    // colisionFigure.push(new Collsion_CubeDown(new Point(705, 246),new Point(735, 246),false)); 
    // colisionFigure.push(new Collsion_CubeDown(new Point(735, 0),new Point(795, 0),false)); 

    boardsLevel.push(new board(Level_1,Level_col_1,Level_row_1,1));
    //colisionFigure.push(new Collsion_CubeRelative(new Point(650, 300),new Point(690, 300),new Point(690, 320),new Point(690, 320)));


    // hide the webpage loading message
    document.getElementById('loadingMessage').style.visibility = "hidden";

    canvas = document.getElementById("keyboardCanvas");
    ctx = canvas.getContext("2d");
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    
    //Player
    Player = new Player( window.innerWidth*0.1, window.innerHeight*0.5,"images/defaultperson.png","images/defaultpersonleft.png");
    ObjectsGame[0] = new PlayerAnimation(ctx, Player);  

    //Coins
    ObjectsGame[1] = new CoinsAnimation(ctx, new Coin(250, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[2] = new CoinsAnimation(ctx, new Coin( 450, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[3] = new CoinsAnimation(ctx, new Coin( 40, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[4] = new CoinsAnimation(ctx, new Coin( 100, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    //ObjectsGame[5] = new CoinsAnimation(ctx, new Coin( 480, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 

    //Enemy
        ObjectsGame[5] = new EnemyAnimation(ctx,  new Enemy(window.innerWidth*0.3,window.innerHeight*0.5,EnemySprite));  

    //change size for window
    const CANVAS_WIDTH = 1000;
    const CANVAS_HEIGHT = 500;
    var propx = (window.innerWidth*100)/CANVAS_WIDTH;
    var propy = (window.innerHeight*100)/CANVAS_HEIGHT;
    for(let i=0;i<colisionFigure.length;i++)
    {
        if(colisionFigure[i].name == "DownCube")
        {
        colisionFigure[i].point1.x*=propx/100.0;
        colisionFigure[i].point1.y*=propy/100.0;
        colisionFigure[i].point2.x*=propx/100.0;
        colisionFigure[i].point2.y*=propy/100.0;   
        }
        if(colisionFigure[i].name == "RelativeCube")
        {
        colisionFigure[i].point1.x*=propx/100.0;
        colisionFigure[i].point1.y*=propy/100.0;
        colisionFigure[i].point2.x*=propx/100.0;
        colisionFigure[i].point2.y*=propy/100.0;   
        colisionFigure[i].point3.x*=propx/100.0;
        colisionFigure[i].point3.y*=propy/100.0;
        colisionFigure[i].point4.x*=propx/100.0;
        colisionFigure[i].point4.y*=propy/100.0;   
        }
    }
    for(let i = 0; i < ObjectsGame.length; i++)
    {
        ObjectsGame[i].x*=propx/100.0;
        ObjectsGame[i].y*=propy/100.0;
    }

    document.addEventListener('keydown', keydownHandler);

    canvas.addEventListener('mousemove', function(evt) {
    var mousePos = getMousePos(canvas, evt);
    //var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;

    //document.getElementById("positionMX").innerHTML= "Mouse X "+activeMouseClickx;
    //document.getElementById("positionMY").innerHTML= "Mouse Y "+activeMouseClicky;
    
    }, false);


var clientX, clientY;

canvas.addEventListener('touchstart', function(e) {
  // Cache the client X/Y coordinates
  activeMouseClickx = e.touches[0].clientX;
  activeMouseClicky = e.touches[0].clientY;
  //document.getElementById("positionMX").innerHTML= "Mouse X "+activeMouseClickx;
    //document.getElementById("positionMY").innerHTML= "Mouse Y "+activeMouseClicky;
}, false);

canvas.addEventListener('touchend', function(e) {
  var deltaX, deltaY;

  // Compute the change in X and Y coordinates. 
  // The first touch point in the changedTouches
  // list is the touch point that was just removed from the surface.
  activeMouseClicky = e.changedTouches[0].clientX - activeMouseClicky;
  activeMouseClicky = e.changedTouches[0].clientY - activeMouseClicky;
  //document.getElementById("positionMX").innerHTML= "Mouse X "+activeMouseClickx;
    //document.getElementById("positionMY").innerHTML= "Mouse Y "+activeMouseClicky;

  // Process the data ... 
}, false);

    canvas.addEventListener("click", function (evt) {
    var mousePos = getMousePos(canvas, evt);
                //alert(mousePos.x + ',' + mousePos.y);
                // activeMouseClickx = mousePos.x;
                // activeMouseClicky = mousePos.y;
                //activeX + ',' + activeY );
    }, false);
    createColison(boardsLevel[0]);
    renderCanvas();
    
}

function renderCanvas()
{
    //document.getElementById("Score").innerHTML= "Score : "+score;
    ObjectsGame[0].flagColision = false;
    requestAnimationFrame(renderCanvas);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                drawBoard(boardsLevel[0]);
                /* Step 3 of 3 */
                /* Draw the animations */
                for (let i = 0; i < ObjectsGame.length; i++)
                {
                    ObjectsGame[i].renderObject();
                }

                checkCoinColision();
                drawLine();
                vJoyFun();
                checkGravitiColison();
                checkColisionForEnemy();
                checkCollisionForFireBall();
                psButton();
}
function createColison(level)
{
    
    let board = level.Level;
    let col = level.Level_col;
    let row = level.Level_row;
    let lastF = 0;
    for (let i = 0; i < row; i++)
    {
        let j = 0;
        for (; lastF < (col)*i; lastF++)
        {
            if(board[lastF] !=0 && board[lastF]!=-1)
            {
                let x = j*0.05*canvas.width;
                let y =i*0.1 *canvas.height;
                colisionFigure.push(new Collsion_CubeDown(new Point(x,y),new Point(x+(0.05 *canvas.width), y),false));
            }
            j++;
        }
    }
}
function drawBoard(level)
{
    let board = level.Level;
    let col = level.Level_col;
    let row = level.Level_row;
    let lastF = 0;
    for (let i = 0; i < row; i++)
    {
        let j = 0;
        for (; lastF < col*i; lastF++)
        {
            if(board[lastF] !=0 && board[lastF]!=-1)
            {
            let elements = new Image();
            elements.src = "images/boardElemets/Tiles/"+board[lastF]+".png";
            ctx.drawImage(elements,j*0.05*canvas.width, i*0.1 *canvas.height, 0.05*canvas.width, 0.1 *canvas.height);
            }
            j++;
        }
    }

}
function checkCoinColision()
{
                //Get coin
                for (let i = 1; i < ObjectsGame.length; i++)
                {
                        if((ObjectsGame[0].centreX < ObjectsGame[i].centreX + 20) &&
                        (ObjectsGame[0].centreX > ObjectsGame[i].centreX - 20) && 
                        (ObjectsGame[0].centreY < ObjectsGame[i].centreY + 20) &&
                        (ObjectsGame[0].centreY > ObjectsGame[i].centreY - 20) &&
                         (ObjectsGame[i].animationIsDisplayed == true) 
                         && (ObjectsGame[i].Gameobject.name == "coin"))
                        {
                            score++;
                            ObjectsGame[i].stopAndHide();
                        }
                }
                
                //ENEMY COLLISION
                for (let i = 1; i < ObjectsGame.length; i++)
                {
                        if((ObjectsGame[0].centreX < ObjectsGame[i].centreX + 20) &&
                        (ObjectsGame[0].centreX > ObjectsGame[i].centreX - 20) && 
                        (ObjectsGame[0].centreY < ObjectsGame[i].centreY + 20) &&
                        (ObjectsGame[0].centreY > ObjectsGame[i].centreY - 20) &&
                         (ObjectsGame[i].animationIsDisplayed == true) 
                         && (ObjectsGame[i].Gameobject.name == "enemy"))
                        {
                            ObjectsGame[0].isdead = true;
                            ObjectsGame[0].stopAndHide();
                        }
                }

                //DEAD CUBE COLLISION
                for (let i = 1; i < colisionFigure.length; i++)
                {
                    if((ObjectsGame[0].centreX >= colisionFigure[i].point1.x) && (ObjectsGame[0].centreX <= colisionFigure[i].point2.x)
                    && (ObjectsGame[0].centreY+20 > colisionFigure[i].point1.y)
                    && ( colisionFigure[i].name == "DownCube") && ( colisionFigure[i].deadColision == true))
                        {
                            ObjectsGame[0].isdead = true;
                            ObjectsGame[0].stopAndHide();
                        }
                }

            for(let j = 0; j < ObjectsGame.length; j++)
            {
                for (let i = 0; i <  ObjectsGame.length; i++)
                {
                        if((ObjectsGame[j].centreX < ObjectsGame[i].centreX + 20) &&
                        (ObjectsGame[j].centreX > ObjectsGame[i].centreX - 20) && 
                        (ObjectsGame[j].centreY < ObjectsGame[i].centreY + 20) &&
                        (ObjectsGame[j].centreY > ObjectsGame[i].centreY - 20) &&
                         (ObjectsGame[j].animationIsDisplayed == true) 
                         && (ObjectsGame[i].Gameobject.name == "enemy") && (ObjectsGame[i].animationIsDisplayed == true)
                         && (ObjectsGame[j].Gameobject.name == "FireBall"))
                        {
                            //animationIsDisplayed
                            ObjectsGame[i].stopAndHide();
                            ObjectsGame[j].stopAndHide();
                        }
                }
            }
}

function checkColisionForEnemy()
{

                    //GENERAL COLLISION "DownCube" ENEMY
            let flagBreak = false;
            for(let j = 0; j < ObjectsGame.length; j++)
            {
                for (let i = 0; i < colisionFigure.length; i++)
                {
                    if((ObjectsGame[j].centreX >= colisionFigure[i].point1.x) && (ObjectsGame[j].centreX <= colisionFigure[i].point2.x)
                    && (ObjectsGame[j].centreY >= colisionFigure[i].point1.y) && (ObjectsGame[j].centreY <= colisionFigure[i].downY) 
                    && ( colisionFigure[i].name == "DownCube") && 
                        ( ObjectsGame[j].Gameobject.name == "enemy"))
                    {
                                if((ObjectsGame[j].direction == 1) && (ObjectsGame[j].Gameobject.name == "enemy"))
                                {
                                    console.log("colison! enemy change to right");
                                    ObjectsGame[j].centreX += 5;
                                    ObjectsGame[j].setDirection(2);
                                    flagBreak = true;
                                    break;
                                }
                                else if((ObjectsGame[j].direction == 2) && (ObjectsGame[j].Gameobject.name == "enemy"))
                                {
                                    console.log("colison! enemy change to left");
                                    ObjectsGame[j].centreX -= 5;
                                    ObjectsGame[j].setDirection(1);
                                    flagBreak = true;
                                    break;
                                }
                    }
                    else if((ObjectsGame[j].centreX >= colisionFigure[i].point1.x)
                     && (ObjectsGame[j].centreX <= colisionFigure[i].point2.x)&& 
                        ( ObjectsGame[j].Gameobject.name == "enemy"))
                    {
                        //Gravitation
                        if((ObjectsGame[j].centreY+15 < colisionFigure[i].point1.y) && offgravity == false)
                        {
                            console.log("colison! Gravity Enemy");
                            gravity = true;
                            falseDeltaEnemy += 0.4;
                            ObjectsGame[j].centreY+=falseDeltaEnemy;
                        }
                        else
                        {
                            falseDeltaEnemy =0;
                            gravity = false;
                        }
                    }
                }
                if(flagBreak == true)
                {
                    break;
                }
            }
                
}

function checkGravitiColison()
{
    //let flagBreak = false;
                //GENERAL COLLISION
                let stepSize = 5;
                for (let i = 0; i < colisionFigure.length; i++)
                {
                    if((ObjectsGame[0].centreX >= colisionFigure[i].point1.x)&& ( colisionFigure[i].name == "DownCube") && (ObjectsGame[0].centreX <= colisionFigure[i].point2.x)
                    && (ObjectsGame[0].centreY >= colisionFigure[i].point1.y) && (ObjectsGame[0].centreY <= colisionFigure[i].downY) 
                     && (
                        ( ObjectsGame[0].Gameobject.name == "player")))
                    {
                        console.log("colison! downcube");
                        //console.log(ObjectsGame[0].direction);

                            if (ObjectsGame[0].direction === ObjectsGame[0].UP)
                            {
                                //console.log("1");
                                ObjectsGame[0].centreY += stepSize*3;
                                break;
                            } 
                            else if (ObjectsGame[0].direction === ObjectsGame[0].LEFT)
                            {
                                //console.log("2");
                                //ObjectsGame[0].centreX += stepSize*3;
                                ObjectsGame[0].stayPosition("left");
                                //flagBreak = true;
                                break;
                            }
                            else if (ObjectsGame[0].direction === ObjectsGame[0].DOWN)
                            {
                                //console.log("3");
                                ObjectsGame[j].centreY -= stepSize;
                                break;
                            } 
                            else if (ObjectsGame[0].direction === ObjectsGame[0].RIGHT)
                            {
                                //console.log("4");
                               //ObjectsGame[0].centreX -= stepSize*3;
                                ObjectsGame[0].stayPosition("right");
                                //flagBreak = true;
                                break;
                            }
                            else if (ObjectsGame[0].direction === 0)
                            {
                                if(lastPushButton === ObjectsGame[0].LEFT)
                                {
                                   ObjectsGame[0].centreX += stepSize;
                                    break;
                                }
                                else if(lastPushButton === ObjectsGame[0].RIGHT)
                                {
                                    ObjectsGame[0].centreX -= stepSize;
                                    break;
                                }
                                
                                //console.log("5");
                                //ObjectsGame[0].centreY = colisionFigure[i].point1.y -10;
                            }
                    }
                    else  if((ObjectsGame[0].centreX >= colisionFigure[i].point1.x)&& ( colisionFigure[i].name == "RelativeCube") && (ObjectsGame[0].centreX <= colisionFigure[i].point2.x)
                    && (ObjectsGame[0].centreY >= colisionFigure[i].point1.y) && (ObjectsGame[0].centreY <= colisionFigure[i].point4.y) 
                    && (
                        ( ObjectsGame[j].Gameobject.name == "player")))
                    {
                        let stepSize = 5;
                        console.log("colison! Relative");
                        //console.log(ObjectsGame[0].direction);
                            if (ObjectsGame[0].direction === ObjectsGame[0].UP)
                            {
                                //console.log("1");
                                ObjectsGame[0].centreY += stepSize*3;
                                break;
                                //ObjectsGame[0].stayPosition();
                            } 
                            else if (ObjectsGame[0].direction === ObjectsGame[0].LEFT)
                            {
                                break;
                                //console.log("2");
                               // ObjectsGame[0].centreX += stepSize*3;
                            }
                            else if (ObjectsGame[0].direction === ObjectsGame[0].DOWN)
                            {
                                break;
                                //console.log("3");
                                //ObjectsGame[0].centreY -= stepSize;
                            } 
                            else if (ObjectsGame[0].direction === ObjectsGame[0].RIGHT)
                            {
                                break;
                                //console.log("4");
                                //ObjectsGame[0].centreX -= stepSize*3;
                            }
                            else if (ObjectsGame[0].direction === 0)
                            {
                                
                            //     if(lastPushButton === ObjectsGame[0].LEFT)
                            //     {
                            //         ObjectsGame[0].centreX += stepSize*3;
                            //     }
                            //     else if(lastPushButton === ObjectsGame[0].RIGHT)
                            //     {
                            //         ObjectsGame[0].centreX -= stepSize*3;
                            //     }
                                //console.log("5");
                                ObjectsGame[0].centreY = colisionFigure[i].point1.y -15;
                                break;
                            }
                    }
                    else if((ObjectsGame[0].centreX >= colisionFigure[i].point1.x)
                     && (ObjectsGame[0].centreX <= colisionFigure[i].point2.x))
                    {
                        console.log("colison! Gravity");
                        //Gravitation
                        if((ObjectsGame[0].centreY+15 < colisionFigure[i].point1.y) && offgravity == false)
                        {
                            gravity = true;
                            falseDelta += 0.4;
                            ObjectsGame[0].centreY+=falseDelta;
                        }
                        else
                        {
                            falseDelta =0;
                            gravity = false;
                        }
                        break;
                    }
                }
           
           if(true == offgravity)
                    {
                        this.falseDeltaUP -= 0.4;
                        ObjectsGame[0].centreY -= falseDeltaUP;
                        if( this.falseDeltaUP < 0)
                            {
                                this.falseDeltaUP = 10;
                                offgravity = false;
                            }
                        }
}

function checkCollisionForFireBall()
{
    for (let j = 0; j < ObjectsGame.length; j++)
                {
                for (let i = 0; i < colisionFigure.length; i++)
                {
                    if((ObjectsGame[j].centreX >= colisionFigure[i].point1.x) && (ObjectsGame[j].centreX <= colisionFigure[i].point2.x)
                    && (ObjectsGame[j].centreY >= colisionFigure[i].point1.y) && (ObjectsGame[j].centreY <= colisionFigure[i].downY) 
                    && ( colisionFigure[i].name == "DownCube") && (
                        ( ObjectsGame[j].Gameobject.name == "FireBall")))
                    {
                        ObjectsGame[j].stopAndHide();
                        //ObjectsGame.splice(j, 1);
                        //j--;
                    } 
                }
            }
}

function drawLine()
{
    if(true == showCollisonLine)
                {
                ctx.beginPath();
                ctx.strokeStyle = "#FF0000";

                for(let i=0;i<colisionFigure.length;i++)
                {
                    if(colisionFigure[i].name == "DownCube")
                    {
                            ctx.beginPath();
                            ctx.moveTo(colisionFigure[i].point1.x, colisionFigure[i].point1.y);
                            ctx.lineTo(colisionFigure[i].point2.x, colisionFigure[i].point2.y);
                            ctx.stroke();
                    }
                    //colisionFigure.point1.x *=2;
                    //colisionFigure.point1.y *=2;
                }

                //ctx.moveTo(0, 390);
                // ctx.lineTo(15, 390);

                // ctx.lineTo(15, 440);
                // ctx.lineTo(50, 440);


                // ctx.lineTo(50, 400);
                // ctx.lineTo(130, 400);

                // ctx.lineTo(130, 440);
                // ctx.lineTo(250, 440);

                // ctx.lineTo(250, 400);
                // ctx.lineTo(460, 400);

                // ctx.lineTo(460, 280);
                // ctx.lineTo(520, 280);
                // ctx.lineTo(520, 400);
                // ctx.lineTo(640, 400);
                // ctx.lineTo(640, 425);
                // ctx.lineTo(691, 425);
                // ctx.stroke();

                // ctx.moveTo(650, 290);
                // ctx.lineTo(690, 290);
                // ctx.lineTo(650, 320);
                // ctx.lineTo(690, 320);
                ctx.stroke();

                for(let j = 0; j < ObjectsGame.length; j++)
                {
                    ctx.beginPath();
                    ctx.arc(ObjectsGame[j].centreX, ObjectsGame[j].centreY, ObjectsGame[j].size/2.0, 0, 2 * Math.PI);
                    ctx.stroke();   
                }
                // ctx.beginPath();
                // ctx.arc(ObjectsGame[0].centreX, ObjectsGame[0].centreY, 20, 0, 2 * Math.PI);
                // ctx.stroke(); 

                // ctx.beginPath();
                // ctx.arc(ObjectsGame[5].centreX, ObjectsGame[5].centreY, 20, 0, 2 * Math.PI);
                // ctx.stroke(); 
                }
}

function keydownHandler(e)
{
    let UP = 0;
let LEFT = 1;
let DOWN = 2;
let RIGHT = 3;
let stepSize = 10;
console.log(keydownHandler);

                if (e.keyCode === 37)  // left
                {
                   // ObjectsGame[0].centreX -= stepSize;
                    ObjectsGame[0].setDirection(1);
                } else if (e.keyCode === 32) // attack
                {
                 //   ObjectsGame[0].centreX += stepSize;
                 //ObjectsGame[0].ctx.scale(-1, 1);
                    ObjectsGame[0].setDirection(3);
                }
                 else if (e.keyCode === 38) // up
                {
                    offgravity = true;
                    ObjectsGame[0].setDirection(5);
                } else if (e.keyCode === 39 && flagRight == true) // right
                {
                  //  ObjectsGame[0].centreX += stepSize;
                    ObjectsGame[0].setDirection(4);
                } else if (e.keyCode === 40) // down
                {
                  //  ObjectsGame[0].centreY += stepSize;
                    ObjectsGame[0].setDirection(2);
                }
                else if(e.keyCode === 102 || e.keyCode === 70)
                {
                    ObjectsGame.push(new FireBallAnimation(ctx,  new FireBall(ObjectsGame[0].centreX, ObjectsGame[0].centreY,FireBallSprite)));
                    if(ObjectsGame[0].left == true)
                    {
                        ObjectsGame[ObjectsGame.length-1].setDirection(0);
                        ObjectsGame[0].setDirection(2);
                    }
                    else
                    {
                        ObjectsGame[ObjectsGame.length-1].setDirection(4);
                        ObjectsGame[0].setDirection(2);
                    }

                }
                else if(e.keyCode === 67 || e.keyCode === 99)
                {
                    showCollisonLine = !showCollisonLine;
                }
                pushbutton = true;
}

function vJoyFun()
{
    ctx.strokeStyle = "yellow";
                ctx.beginPath();
                ctx.arc(FramevjoyX, FramevjoyY, (window.innerHeight* 0.1), 0, 2 * Math.PI);
                ctx.stroke(); 

                ctx.beginPath();
                ctx.arc(vjoyX, vjoyY, (window.innerHeight* 0.05), 0, 2 * Math.PI);
                ctx.stroke();

            //if((activeX > 0) && (activeX < 500) && (activeY > 0) && (activeY < 500))
            //{
                vjoyX = FramevjoyX;
                vjoyY = FramevjoyY;
                line();
            //}
}

function psButton()
{
    ctx.drawImage(reloadButton, window.innerWidth*0.9, window.innerHeight*0.1,window.innerHeight*0.1, window.innerHeight*0.1);
    ctx.drawImage(crossButton, window.innerWidth*0.8, window.innerHeight*0.9,window.innerHeight*0.1, window.innerHeight*0.1);
    ctx.drawImage(circleButton, window.innerWidth*0.9, window.innerHeight*0.9,window.innerHeight*0.1, window.innerHeight*0.1);

    let xjump =window.innerWidth*0.8 + window.innerHeight*0.05;
    let yjump = window.innerHeight*0.9 + window.innerHeight*0.05;

    let xfire =window.innerWidth*0.9 + window.innerHeight*0.05;
    let yfire =window.innerHeight*0.9 + window.innerHeight*0.05;

    let xreset =window.innerWidth*0.9 + window.innerHeight*0.05;
    let yreset =window.innerHeight*0.1 + window.innerHeight*0.05;

                ctx.strokeStyle = "yellow";
                ctx.beginPath();
                ctx.arc(xfire, yfire,  window.innerHeight*0.05, 0, 2 * Math.PI);
                ctx.stroke(); 

                ctx.beginPath();
                ctx.arc(xjump, yjump,  window.innerHeight*0.05, 0, 2 * Math.PI);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(window.innerWidth*0.9 + window.innerHeight*0.05, window.innerHeight*0.1 + window.innerHeight*0.05,  window.innerHeight*0.05, 0, 2 * Math.PI);
                ctx.stroke();

                //fire button
                if((activeMouseClickx >= xjump - (window.innerHeight* 0.05) && activeMouseClickx <= xjump +  (window.innerHeight* 0.05)) && (activeMouseClicky >= yfire - (window.innerWidth* 0.05) && activeMouseClicky <= yfire + (window.innerWidth* 0.05)))
                {
                    offgravity = true;
                    ObjectsGame[0].setDirection(5);
                }
                if((activeMouseClickx >= xfire - (window.innerHeight* 0.05) && activeMouseClickx <= xfire +  (window.innerHeight* 0.05)) && (activeMouseClicky >= yjump - (window.innerWidth* 0.05) && activeMouseClicky <= yjump + (window.innerWidth* 0.05)))
                {
                    ObjectsGame.push(new FireBallAnimation(ctx,  new FireBall(ObjectsGame[0].centreX, ObjectsGame[0].centreY,FireBallSprite)));
                    if(ObjectsGame[0].left == true)
                    {
                        ObjectsGame[ObjectsGame.length-1].setDirection(0);
                        ObjectsGame[0].setDirection(2);
                    }
                    else
                    {
                        ObjectsGame[ObjectsGame.length-1].setDirection(4);
                        ObjectsGame[0].setDirection(2);
                    }
                }
                if((activeMouseClickx >= xreset - (window.innerHeight* 0.05) && activeMouseClickx <= xreset +  (window.innerHeight* 0.05)) && (activeMouseClicky >= yreset - (window.innerWidth* 0.05) && activeMouseClicky <= yreset + (window.innerWidth* 0.05)))
                {
                    reset();
                }
}

function line()
            {
                if((activeMouseClickx >= vjoyX - (window.innerHeight* 0.1) && activeMouseClickx <= vjoyX +  (window.innerHeight* 0.1)) && (activeMouseClicky >= vjoyY - (window.innerWidth* 0.1) && activeMouseClicky <= vjoyY + (window.innerWidth* 0.1)))
                {
                    vjoyX = activeMouseClickx;
                    vjoyY = activeMouseClicky;
                    deltX = null;
                    deltY = null;

                    if(activeMouseClickx > FramevjoyX)
                    {
                        deltX = activeMouseClickx - FramevjoyX;
                    }
                    else
                    {
                        deltX = FramevjoyX - activeMouseClickx;
                    }

                    if( activeMouseClicky > FramevjoyY)
                    {
                        deltY = activeMouseClicky - FramevjoyY;
                    }
                    else
                    {
                        deltY = FramevjoyY - activeMouseClicky;
                    }

                   var a = ((FramevjoyY - activeMouseClicky) / (FramevjoyX - activeMouseClickx));
                   var b =  activeY - (activeX*a);

                    if(a <= 2 && a >= -2)
                    {
                        
                        if(FramevjoyX < activeMouseClickx)
                        {
                            //newPositionx = 0;
                            //activeX += 1;//(deltY+deltX)/2;
                            ObjectsGame[0].setDirection(4);
                            //document.getElementById("positionMX").innerHTML= "Right "+activeMouseClickx;
                        }
                        else if(FramevjoyX > activeMouseClickx)
                        {
                            //newPositionx = 500;
                            //activeX -= 1;//(deltY+deltX)/2;
                            ObjectsGame[0].setDirection(1);
                            //document.getElementById("positionMX").innerHTML= "Left "+activeMouseClickx;         
                        }

                                console.log("a : " + a);
                            //console.log("b : " + b);
                            //console.log("activeX : " + activeX);
                            //console.log("activeY : " + activeY);
                            //activeY = (activeX*(-a)) - (b);
                            //newPositiony = (newPositionx*(-a)) - (b);
                            
                            //if(activeY < 0)
                            //{
                           //     activeY = - activeY;
                            //}
                    }
                    else(a <= 2 && a >= -2)
                    {
                        if(a > 0 && FramevjoyY > activeMouseClicky)
                        {
                            //activeY -= 1;//(deltY+deltX)/2;
                        }
                        else if(a < 0 && FramevjoyY > activeMouseClicky)
                        {
                            //activeY -= 1;//(deltY+deltX)/2;
                        }
                        else if(a < 0 && FramevjoyY < activeMouseClicky)
                        {
                            //activeY += 1;//(deltY+deltX)/2;
                        }
                        else if(a > 0 && FramevjoyY < activeMouseClicky)
                        {
                            //activeY += 1;//(deltY+deltX)/2;
                        }

                        //activeY = (activeX*(-a)) - (b);
                        //newPositiony = (newPositionx*(-a)) - (b);
                        //activeX = (activeY-b/a);
                        
                        
                    }

                        


                    //s

                }
                

            }

function reset()
{
        //Player
        activeX =100;
        activeY =100;

        //Player = new Player( window.innerWidth*0.1, window.innerHeight*0.5,"images/defaultperson.png","images/defaultpersonleft.png");
        ObjectsGame[0] = new PlayerAnimation(ctx, Player);  
    ObjectsGame[0].isdead = false;
    //Coins
    ObjectsGame[1] = new CoinsAnimation(ctx, new Coin(190, 410,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[2] = new CoinsAnimation(ctx, new Coin( 340, 380,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[3] = new CoinsAnimation(ctx, new Coin( 85, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 
    ObjectsGame[4] = new CoinsAnimation(ctx, new Coin( 480, 270,CoinSprite));// 40, 40, 40,canvas.width, canvas.height, true,pushbutton); 

    //Enemy
        ObjectsGame[5] = new EnemyAnimation(ctx,  new Enemy(window.innerWidth*0.3,window.innerHeight*0.5,EnemySprite));  
}
</script>
</head>

<body>
<canvas id = "keyboardCanvas" tabindex="1">
Your browser does not support the HTML5 'Canvas' tag.
</canvas>
<audio id="myAudio">
        <source src="mp3/Hyrule.mp3" />  
</audio>         
<audio autoplay loop>
    <source src="mp3/Hyrule.mp3">
</audio>
</body>
</html>